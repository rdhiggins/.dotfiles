#!/usr/bin/env ruby
require 'shellwords'
require 'optparse'

$extension = '.xcodeproj'
$xcode = 'Xcode.app'

opt_parser = OptionParser.new do |opt|
  opt.banner = "Usage: xc [filename] [OPTIONS]"
  opt.separator  ""
  opt.separator  "Options:"

  opt.on("-b","--beta", "starts xcode-beta") do
    $xcode = 'Xcode-beta.app'
  end
end

opt_parser.parse!

def start_xcode(filename)
  puts "Opening #{File.basename(filename, $extension)}"
  %x(open -a /Applications/#{$xcode} #{Shellwords.escape(filename)})
end

if ARGV.count == 1 then
  start_xcode(ARGV[0])
else
  if File.exists?("/Applications/#{$xcode}") then
    if !((filename = Dir.glob("*#{$extension}").first).nil?)
      p filename
      start_xcode(filename)
    else
      puts "Did not find a project to open"
    end
  else
    puts "Xcode is not installed"
  end
end
